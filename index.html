<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 회사 정보 추가 -->
    <meta name="author" content="OKSTAR KOREA COMPANY">
    <meta name="copyright" content="© 2024 OKSTAR KOREA COMPANY. All Rights Reserved.">
    <meta name="description" content="Professional T-Shirt Design Solution by OKSTAR KOREA">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX'); // 여기에 실제 측정 ID 입력
    </script>
    
    <title>옥스타 프린팅 프로그램 - T-Print Studio v3.0 | OKSTAR KOREA COMPANY</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #1f2937;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .company-badge {
            display: inline-block;
            background: #4F46E5;
            color: white;
            padding: 6px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .feature-badges {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .badge {
            background: #ecfdf5;
            color: #059669;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #86efac;
        }

        .instructions {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #92400e;
        }

        .upload-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title.front {
            color: #3b82f6;
        }

        .section-title.back {
            color: #8b5cf6;
        }

        .upload-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .upload-box input[type="file"] {
            display: none;
        }

        .upload-label {
            display: block;
            padding: 30px 15px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            color: #475569;
            background: white;
        }

        .upload-label:hover {
            border-color: #6366f1;
            background: #f0f9ff;
        }

        .upload-label.uploaded {
            border-color: #10b981;
            background: #ecfdf5;
            color: #059669;
        }

        .file-list {
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px;
            background: white;
            margin-top: 10px;
            font-size: 12px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px;
            margin: 2px 0;
            background: #f8fafc;
            border-radius: 4px;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .toggle-btn {
            padding: 10px 30px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .toggle-btn.front.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .toggle-btn.back.active {
            background: #8b5cf6;
            border-color: #8b5cf6;
        }

        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .canvas-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .canvas-section.hidden {
            display: none;
        }

        .canvas-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        canvas {
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            background: white;
            width: 100%;
            height: auto;
            cursor: move;
        }

        .controls {
            margin-top: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-label {
            font-size: 13px;
            color: #475569;
            min-width: 60px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            background: #e2e8f0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }

        .scale-value {
            min-width: 45px;
            text-align: right;
            font-weight: bold;
            color: #1f2937;
            font-size: 13px;
        }

        .tab-navigation {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding: 10px;
            background: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab-button:hover {
            background: #f0f9ff;
            border-color: #6366f1;
        }

        .tab-button.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .progress-container {
            margin: 20px 0;
            padding: 20px;
            background: #f0f9ff;
            border-radius: 10px;
            border: 2px solid #3b82f6;
            display: none;
        }

        .progress-text {
            font-size: 16px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 10px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #dbeafe;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .save-button {
            width: 100%;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .save-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .save-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .save-button.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 30px;
            background: #f9fafb;
            border-radius: 10px;
        }

        .footer-company {
            font-size: 14px;
            font-weight: bold;
            color: #4F46E5;
            margin-bottom: 5px;
        }

        @media (max-width: 1200px) {
            .canvas-container {
                grid-template-columns: 1fr;
            }
            
            .upload-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .upload-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                🎨 옥스타 프린팅 프로그램
                <span class="version-badge">v3.0</span>
            </h1>
            <p class="subtitle">Professional T-Shirt Design Solution</p>
            <div class="company-badge">OKSTAR KOREA COMPANY</div>
            <div class="feature-badges">
                <span class="badge">👔 앞판 작업</span>
                <span class="badge">🎨 뒷판 작업</span>
                <span class="badge">📦 앞뒤 세트 저장</span>
                <span class="badge">✨ 위치 독립 설정</span>
            </div>
        </div>
        
        <div class="instructions">
            💡 <strong>사용법:</strong> 
            1️⃣ 앞판/뒷판 무지 티셔츠 각각 업로드 (같은 색상끼리)
            2️⃣ 앞판 디자인 배치 (작게, 가슴 위치)
            3️⃣ 뒷판 디자인 배치 (크게, 등 위치)
            4️⃣ 저장 → 앞뒤 세트로 자동 저장!
        </div>

        <div class="upload-grid">
            <!-- 앞판 업로드 섹션 -->
            <div class="upload-section">
                <div class="section-title front">
                    👔 앞판 (Front)
                </div>
                <div class="upload-row">
                    <div>
                        <input type="file" id="frontTshirtInput" accept="image/*" multiple>
                        <label for="frontTshirtInput" class="upload-label" id="frontTshirtLabel">
                            📁 앞판 무지티<br>
                            <small>여러 개 선택 가능</small>
                        </label>
                        <div class="file-list" id="frontTshirtList"></div>
                    </div>
                    <div>
                        <input type="file" id="frontDesignInput" accept="image/*">
                        <label for="frontDesignInput" class="upload-label" id="frontDesignLabel">
                            🎨 앞판 디자인<br>
                            <small>가슴 로고용</small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 뒷판 업로드 섹션 -->
            <div class="upload-section">
                <div class="section-title back">
                    🎨 뒷판 (Back)
                </div>
                <div class="upload-row">
                    <div>
                        <input type="file" id="backTshirtInput" accept="image/*" multiple>
                        <label for="backTshirtInput" class="upload-label" id="backTshirtLabel">
                            📁 뒷판 무지티<br>
                            <small>여러 개 선택 가능</small>
                        </label>
                        <div class="file-list" id="backTshirtList"></div>
                    </div>
                    <div>
                        <input type="file" id="backDesignInput" accept="image/*">
                        <label for="backDesignInput" class="upload-label" id="backDesignLabel">
                            🎨 뒷판 디자인<br>
                            <small>등 전체용</small>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 티셔츠 색상 탭 -->
        <div class="tab-navigation" id="tabNav">
            <span style="color: #94a3b8; padding: 6px;">티셔츠를 업로드하면 색상별 탭이 표시됩니다</span>
        </div>

        <!-- 뷰 전환 버튼 -->
        <div class="view-toggle">
            <button class="toggle-btn front active" id="viewFront">👔 앞판 보기</button>
            <button class="toggle-btn back" id="viewBack">🎨 뒷판 보기</button>
            <button class="toggle-btn" id="viewBoth">👀 동시 보기</button>
        </div>

        <!-- 캔버스 영역 -->
        <div class="canvas-container" id="canvasContainer">
            <!-- 앞판 캔버스 -->
            <div class="canvas-section" id="frontSection">
                <div class="canvas-title" style="color: #3b82f6;">👔 앞판 미리보기</div>
                <canvas id="frontCanvas"></canvas>
                <div class="controls">
                    <div class="control-group">
                        <span class="control-label">크기:</span>
                        <input type="range" id="frontScaleSlider" min="5" max="200" value="30">
                        <span class="scale-value" id="frontScaleValue">30%</span>
                    </div>
                </div>
            </div>

            <!-- 뒷판 캔버스 -->
            <div class="canvas-section hidden" id="backSection">
                <div class="canvas-title" style="color: #8b5cf6;">🎨 뒷판 미리보기</div>
                <canvas id="backCanvas"></canvas>
                <div class="controls">
                    <div class="control-group">
                        <span class="control-label">크기:</span>
                        <input type="range" id="backScaleSlider" min="5" max="200" value="100">
                        <span class="scale-value" id="backScaleValue">100%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 진행률 표시 -->
        <div class="progress-container" id="progressBar">
            <div class="progress-text">처리 중...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
        </div>

        <!-- 저장 버튼 -->
        <button id="saveBtn" class="save-button" disabled>
            <span>📦</span>
            <span id="saveBtnText">앞판과 뒷판 파일을 모두 업로드하세요</span>
        </button>

        <!-- 저작권 표시 -->
        <div class="footer">
            <div class="footer-company">OKSTAR KOREA COMPANY</div>
            © 2024 All Rights Reserved. Unauthorized use is strictly prohibited.<br>
            본 프로그램은 OKSTAR KOREA COMPANY의 지적 재산입니다.<br>
            Contact: info@okstar.kr | Support: support@okstar.kr
        </div>
    </div>

    <!-- JSZip 라이브러리 (ZIP 다운로드용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // 콘솔 저작권 표시
        console.log('%c🎨 옥스타 프린팅 프로그램 v3.0', 'font-size: 20px; font-weight: bold; color: #4F46E5;');
        console.log('%c© 2024 OKSTAR KOREA COMPANY', 'font-size: 12px; color: #666;');
        console.log('%c⚠️ 이 프로그램의 무단 복제 및 수정은 법적 제재를 받을 수 있습니다.', 'color: red; font-weight: bold;');
        console.log('%cUnauthorized copying, modification, or distribution is strictly prohibited.', 'color: #ff6b6b; font-style: italic;');

        // Google Analytics 이벤트 추적 함수
        function trackEvent(eventName, parameters) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, parameters);
            }
        }

        // T-Print Studio v3.0 - 앞뒤 동시 작업 시스템
        // Copyright (C) 2024 OKSTAR KOREA COMPANY. All Rights Reserved.
        
        class FrontBackDesigner {
            constructor() {
                // 캔버스 설정
                this.frontCanvas = document.getElementById('frontCanvas');
                this.backCanvas = document.getElementById('backCanvas');
                this.frontCtx = this.frontCanvas.getContext('2d');
                this.backCtx = this.backCanvas.getContext('2d');
                
                // 캔버스 크기
                this.frontCanvas.width = 600;
                this.frontCanvas.height = 720;
                this.backCanvas.width = 600;
                this.backCanvas.height = 720;
                
                // 데이터 관리
                this.data = {
                    front: {
                        tshirts: [],
                        design: null,
                        position: { x: 300, y: 200 },  // 가슴 위치 (상단)
                        scale: 0.3,  // 작게
                        currentIndex: 0
                    },
                    back: {
                        tshirts: [],
                        design: null,
                        position: { x: 300, y: 360 },  // 등 중앙 (중간)
                        scale: 1.0,  // 크게
                        currentIndex: 0
                    }
                };
                
                // 뷰 상태
                this.viewMode = 'front';  // 'front', 'back', 'both'
                
                // 드래그 상태
                this.isDragging = false;
                this.dragTarget = null;  // 'front' or 'back'
                this.dragStart = { x: 0, y: 0 };
                
                // UI 요소
                this.initUIElements();
                this.initEvents();
                this.render();

                // 프로그램 시작 추적
                trackEvent('app_start', {
                    version: '3.0',
                    company: 'OKSTAR KOREA'
                });
            }
            
            initUIElements() {
                // 업로드 인풋
                this.frontTshirtInput = document.getElementById('frontTshirtInput');
                this.backTshirtInput = document.getElementById('backTshirtInput');
                this.frontDesignInput = document.getElementById('frontDesignInput');
                this.backDesignInput = document.getElementById('backDesignInput');
                
                // 라벨
                this.frontTshirtLabel = document.getElementById('frontTshirtLabel');
                this.backTshirtLabel = document.getElementById('backTshirtLabel');
                this.frontDesignLabel = document.getElementById('frontDesignLabel');
                this.backDesignLabel = document.getElementById('backDesignLabel');
                
                // 파일 리스트
                this.frontTshirtList = document.getElementById('frontTshirtList');
                this.backTshirtList = document.getElementById('backTshirtList');
                
                // 슬라이더
                this.frontScaleSlider = document.getElementById('frontScaleSlider');
                this.backScaleSlider = document.getElementById('backScaleSlider');
                this.frontScaleValue = document.getElementById('frontScaleValue');
                this.backScaleValue = document.getElementById('backScaleValue');
                
                // 뷰 토글
                this.viewFrontBtn = document.getElementById('viewFront');
                this.viewBackBtn = document.getElementById('viewBack');
                this.viewBothBtn = document.getElementById('viewBoth');
                
                // 기타
                this.tabNav = document.getElementById('tabNav');
                this.saveBtn = document.getElementById('saveBtn');
                this.saveBtnText = document.getElementById('saveBtnText');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                
                // 섹션
                this.frontSection = document.getElementById('frontSection');
                this.backSection = document.getElementById('backSection');
                this.canvasContainer = document.getElementById('canvasContainer');
            }
            
            initEvents() {
                // 파일 업로드
                this.frontTshirtInput.addEventListener('change', (e) => {
                    this.loadTshirts(e, 'front');
                    trackEvent('file_upload', { type: 'tshirt', side: 'front' });
                });
                this.backTshirtInput.addEventListener('change', (e) => {
                    this.loadTshirts(e, 'back');
                    trackEvent('file_upload', { type: 'tshirt', side: 'back' });
                });
                this.frontDesignInput.addEventListener('change', (e) => {
                    this.loadDesign(e, 'front');
                    trackEvent('file_upload', { type: 'design', side: 'front' });
                });
                this.backDesignInput.addEventListener('change', (e) => {
                    this.loadDesign(e, 'back');
                    trackEvent('file_upload', { type: 'design', side: 'back' });
                });
                
                // 뷰 전환
                this.viewFrontBtn.addEventListener('click', () => {
                    this.setViewMode('front');
                    trackEvent('view_change', { mode: 'front' });
                });
                this.viewBackBtn.addEventListener('click', () => {
                    this.setViewMode('back');
                    trackEvent('view_change', { mode: 'back' });
                });
                this.viewBothBtn.addEventListener('click', () => {
                    this.setViewMode('both');
                    trackEvent('view_change', { mode: 'both' });
                });
                
                // 캔버스 드래그 - 앞판
                this.frontCanvas.addEventListener('mousedown', (e) => this.startDrag(e, 'front'));
                this.frontCanvas.addEventListener('mousemove', (e) => this.drag(e, 'front'));
                this.frontCanvas.addEventListener('mouseup', () => this.endDrag());
                this.frontCanvas.addEventListener('mouseleave', () => this.endDrag());
                
                // 캔버스 드래그 - 뒷판
                this.backCanvas.addEventListener('mousedown', (e) => this.startDrag(e, 'back'));
                this.backCanvas.addEventListener('mousemove', (e) => this.drag(e, 'back'));
                this.backCanvas.addEventListener('mouseup', () => this.endDrag());
                this.backCanvas.addEventListener('mouseleave', () => this.endDrag());
                
                // 슬라이더
                this.frontScaleSlider.addEventListener('input', (e) => this.updateScale(e, 'front'));
                this.backScaleSlider.addEventListener('input', (e) => this.updateScale(e, 'back'));
                
                // 저장
                this.saveBtn.addEventListener('click', () => {
                    this.saveAll();
                    trackEvent('save_images', {
                        count: Math.min(this.data.front.tshirts.length, this.data.back.tshirts.length)
                    });
                });
                
                // 키보드
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        if (!this.saveBtn.disabled) {
                            this.saveAll();
                        }
                    }
                });
            }
            
            setViewMode(mode) {
                this.viewMode = mode;
                
                // 버튼 상태
                this.viewFrontBtn.classList.remove('active');
                this.viewBackBtn.classList.remove('active');
                this.viewBothBtn.classList.remove('active');
                
                // 캔버스 표시
                if (mode === 'front') {
                    this.viewFrontBtn.classList.add('active');
                    this.frontSection.classList.remove('hidden');
                    this.backSection.classList.add('hidden');
                    this.canvasContainer.style.gridTemplateColumns = '1fr';
                } else if (mode === 'back') {
                    this.viewBackBtn.classList.add('active');
                    this.frontSection.classList.add('hidden');
                    this.backSection.classList.remove('hidden');
                    this.canvasContainer.style.gridTemplateColumns = '1fr';
                } else if (mode === 'both') {
                    this.viewBothBtn.classList.add('active');
                    this.frontSection.classList.remove('hidden');
                    this.backSection.classList.remove('hidden');
                    this.canvasContainer.style.gridTemplateColumns = '1fr 1fr';
                }
            }
            
            loadTshirts(e, side) {
                const files = Array.from(e.target.files);
                const validFiles = files.filter(f => f.type.startsWith('image/')).slice(0, 20);
                
                this.data[side].tshirts = [];
                this.data[side].currentIndex = 0;
                
                let loadedCount = 0;
                
                validFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            this.data[side].tshirts.push({
                                name: file.name.split('.')[0],
                                image: img
                            });
                            
                            loadedCount++;
                            if (loadedCount === validFiles.length) {
                                this.updateFileList(side);
                                this.updateTabs();
                                this.checkReadyState();
                                this.render();
                            }
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
                
                // UI 업데이트
                if (side === 'front') {
                    this.frontTshirtLabel.classList.add('uploaded');
                    this.frontTshirtLabel.innerHTML = `✅ 앞판 ${validFiles.length}개<br><small>업로드 완료</small>`;
                } else {
                    this.backTshirtLabel.classList.add('uploaded');
                    this.backTshirtLabel.innerHTML = `✅ 뒷판 ${validFiles.length}개<br><small>업로드 완료</small>`;
                }
            }
            
            loadDesign(e, side) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        this.data[side].design = img;
                        
                        // UI 업데이트
                        if (side === 'front') {
                            this.frontDesignLabel.classList.add('uploaded');
                            this.frontDesignLabel.innerHTML = `✅ 앞판 디자인<br><small>${file.name}</small>`;
                        } else {
                            this.backDesignLabel.classList.add('uploaded');
                            this.backDesignLabel.innerHTML = `✅ 뒷판 디자인<br><small>${file.name}</small>`;
                        }
                        
                        this.checkReadyState();
                        this.render();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            updateFileList(side) {
                const listEl = side === 'front' ? this.frontTshirtList : this.backTshirtList;
                const tshirts = this.data[side].tshirts;
                
                listEl.innerHTML = '';
                
                if (tshirts.length === 0) {
                    listEl.innerHTML = '<span style="color: #94a3b8;">파일 없음</span>';
                    return;
                }
                
                tshirts.forEach((tshirt, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.textContent = tshirt.name;
                    listEl.appendChild(item);
                });
            }
            
            updateTabs() {
                const frontCount = this.data.front.tshirts.length;
                const backCount = this.data.back.tshirts.length;
                
                if (frontCount === 0 && backCount === 0) {
                    this.tabNav.innerHTML = '<span style="color: #94a3b8; padding: 6px;">티셔츠를 업로드하면 색상별 탭이 표시됩니다</span>';
                    return;
                }
                
                this.tabNav.innerHTML = '';
                
                // 앞뒤 매칭된 색상만 표시
                const maxCount = Math.min(frontCount, backCount);
                
                for (let i = 0; i < maxCount; i++) {
                    const frontName = this.data.front.tshirts[i]?.name || '';
                    const backName = this.data.back.tshirts[i]?.name || '';
                    
                    const button = document.createElement('button');
                    button.className = 'tab-button';
                    button.textContent = frontName || backName || `색상 ${i + 1}`;
                    
                    if (i === this.data.front.currentIndex) {
                        button.classList.add('active');
                    }
                    
                    button.addEventListener('click', () => {
                        this.switchTshirt(i);
                    });
                    
                    this.tabNav.appendChild(button);
                }
            }
            
            switchTshirt(index) {
                this.data.front.currentIndex = index;
                this.data.back.currentIndex = index;
                this.updateTabs();
                this.render();
            }
            
            startDrag(e, side) {
                if (!this.data[side].design) return;
                
                const rect = e.target.getBoundingClientRect();
                const canvas = side === 'front' ? this.frontCanvas : this.backCanvas;
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                
                if (this.isInsideDesign(x, y, side)) {
                    this.isDragging = true;
                    this.dragTarget = side;
                    this.dragStart = { x, y };
                    e.target.style.cursor = 'grabbing';
                }
            }
            
            drag(e, side) {
                if (!this.isDragging || this.dragTarget !== side) return;
                
                const rect = e.target.getBoundingClientRect();
                const canvas = side === 'front' ? this.frontCanvas : this.backCanvas;
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                
                const dx = x - this.dragStart.x;
                const dy = y - this.dragStart.y;
                
                this.data[side].position.x += dx;
                this.data[side].position.y += dy;
                
                this.dragStart = { x, y };
                this.render();
            }
            
            endDrag() {
                this.isDragging = false;
                this.dragTarget = null;
                this.frontCanvas.style.cursor = 'move';
                this.backCanvas.style.cursor = 'move';
            }
            
            isInsideDesign(x, y, side) {
                const data = this.data[side];
                if (!data.design) return false;
                
                const width = data.design.width * data.scale * 0.5;
                const height = data.design.height * data.scale * 0.5;
                const pos = data.position;
                
                return x >= pos.x - width/2 && x <= pos.x + width/2 &&
                       y >= pos.y - height/2 && y <= pos.y + height/2;
            }
            
            updateScale(e, side) {
                this.data[side].scale = e.target.value / 100;
                
                if (side === 'front') {
                    this.frontScaleValue.textContent = e.target.value + '%';
                } else {
                    this.backScaleValue.textContent = e.target.value + '%';
                }
                
                this.render();
            }
            
            render() {
                // 앞판 렌더링
                this.renderSide('front', this.frontCanvas, this.frontCtx);
                
                // 뒷판 렌더링
                this.renderSide('back', this.backCanvas, this.backCtx);
            }
            
            renderSide(side, canvas, ctx) {
                const data = this.data[side];
                
                // 캔버스 초기화
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 품질 설정
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // 배경
                ctx.fillStyle = '#f8fafc';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 티셔츠
                const tshirt = data.tshirts[data.currentIndex];
                if (tshirt && tshirt.image) {
                    const scale = Math.min(
                        canvas.width / tshirt.image.width,
                        canvas.height / tshirt.image.height
                    ) * 0.9;
                    
                    const width = tshirt.image.width * scale;
                    const height = tshirt.image.height * scale;
                    const x = (canvas.width - width) / 2;
                    const y = (canvas.height - height) / 2;
                    
                    ctx.drawImage(tshirt.image, x, y, width, height);
                }
                
                // 디자인
                if (data.design) {
                    const width = data.design.width * data.scale * 0.5;
                    const height = data.design.height * data.scale * 0.5;
                    const x = data.position.x - width / 2;
                    const y = data.position.y - height / 2;
                    
                    // 안티앨리어싱 적용
                    if (data.scale < 0.5) {
                        const scaledCanvas = this.highQualityDownscale(
                            data.design, width, height
                        );
                        ctx.drawImage(scaledCanvas, x, y);
                    } else {
                        ctx.drawImage(data.design, x, y, width, height);
                    }
                    
                    // 테두리
                    ctx.strokeStyle = side === 'front' ? 
                        'rgba(59, 130, 246, 0.3)' : 'rgba(139, 92, 246, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.strokeRect(x, y, width, height);
                    ctx.setLineDash([]);
                }

                // OKSTAR 워터마크 (우하단)
                ctx.fillStyle = 'rgba(79, 70, 229, 0.15)';
                ctx.font = 'bold 10px Arial';
                ctx.fillText('OKSTAR', canvas.width - 50, canvas.height - 10);
            }
            
            highQualityDownscale(img, targetWidth, targetHeight) {
                let currentWidth = img.width;
                let currentHeight = img.height;
                let currentImage = img;
                
                while (currentWidth > targetWidth * 2 || currentHeight > targetHeight * 2) {
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    
                    currentWidth = Math.max(currentWidth * 0.5, targetWidth);
                    currentHeight = Math.max(currentHeight * 0.5, targetHeight);
                    
                    tempCanvas.width = currentWidth;
                    tempCanvas.height = currentHeight;
                    
                    tempCtx.imageSmoothingEnabled = true;
                    tempCtx.imageSmoothingQuality = 'high';
                    tempCtx.drawImage(currentImage, 0, 0, currentWidth, currentHeight);
                    
                    currentImage = tempCanvas;
                }
                
                const finalCanvas = document.createElement('canvas');
                const finalCtx = finalCanvas.getContext('2d');
                
                finalCanvas.width = targetWidth;
                finalCanvas.height = targetHeight;
                
                finalCtx.imageSmoothingEnabled = true;
                finalCtx.imageSmoothingQuality = 'high';
                finalCtx.drawImage(currentImage, 0, 0, targetWidth, targetHeight);
                
                return finalCanvas;
            }
            
            checkReadyState() {
                const hasFrontTshirts = this.data.front.tshirts.length > 0;
                const hasBackTshirts = this.data.back.tshirts.length > 0;
                const hasFrontDesign = this.data.front.design !== null;
                const hasBackDesign = this.data.back.design !== null;
                
                if (hasFrontTshirts && hasBackTshirts && hasFrontDesign && hasBackDesign) {
                    this.saveBtn.disabled = false;
                    const count = Math.min(
                        this.data.front.tshirts.length,
                        this.data.back.tshirts.length
                    );
                    this.saveBtnText.textContent = `📦 ${count}개 색상 앞뒤 세트 저장`;
                } else {
                    this.saveBtn.disabled = true;
                    this.saveBtnText.textContent = '앞판과 뒷판 파일을 모두 업로드하세요';
                }
            }
            
            async saveAll() {
                const startTime = Date.now();
                const count = Math.min(
                    this.data.front.tshirts.length,
                    this.data.back.tshirts.length
                );
                
                const files = [];
                
                // 진행률 표시
                this.showProgress(0, count * 2);
                
                for (let i = 0; i < count; i++) {
                    // 앞판 저장
                    const frontCanvas = this.createCanvas(i, 'front');
                    const frontBlob = await this.canvasToBlob(frontCanvas);
                    const frontName = `${this.data.front.tshirts[i].name}_front_OKSTAR.png`;
                    files.push({ name: frontName, blob: frontBlob });
                    
                    this.showProgress(i * 2 + 1, count * 2);
                    
                    // 뒷판 저장
                    const backCanvas = this.createCanvas(i, 'back');
                    const backBlob = await this.canvasToBlob(backCanvas);
                    const backName = `${this.data.back.tshirts[i].name}_back_OKSTAR.png`;
                    files.push({ name: backName, blob: backBlob });
                    
                    this.showProgress(i * 2 + 2, count * 2);
                    
                    await this.delay(50);
                }
                
                // ZIP 다운로드
                await this.downloadAsZip(files);
                
                const processingTime = (Date.now() - startTime) / 1000;
                trackEvent('process_complete', {
                    image_count: count * 2,
                    processing_time: processingTime
                });
                
                this.hideProgress();
                this.showSuccess(count);
            }
            
            createCanvas(index, side) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = 1200;
                canvas.height = 1440;
                
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // 배경
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 티셔츠
                const tshirt = this.data[side].tshirts[index];
                if (tshirt && tshirt.image) {
                    const scale = Math.min(
                        canvas.width / tshirt.image.width,
                        canvas.height / tshirt.image.height
                    ) * 0.9;
                    
                    const width = tshirt.image.width * scale;
                    const height = tshirt.image.height * scale;
                    const x = (canvas.width - width) / 2;
                    const y = (canvas.height - height) / 2;
                    
                    ctx.drawImage(tshirt.image, x, y, width, height);
                }
                
                // 디자인 (스케일 조정 필요)
                if (this.data[side].design) {
                    // 캔버스 크기 비율 계산
                    const scaleRatio = canvas.width / 600;  // 600은 미리보기 캔버스 크기
                    
                    const width = this.data[side].design.width * this.data[side].scale * scaleRatio * 0.5;
                    const height = this.data[side].design.height * this.data[side].scale * scaleRatio * 0.5;
                    const x = (this.data[side].position.x * scaleRatio) - width / 2;
                    const y = (this.data[side].position.y * scaleRatio) - height / 2;
                    
                    if (this.data[side].scale < 0.5) {
                        const scaledCanvas = this.highQualityDownscale(
                            this.data[side].design, width, height
                        );
                        ctx.drawImage(scaledCanvas, x, y);
                    } else {
                        ctx.drawImage(this.data[side].design, x, y, width, height);
                    }
                }
                
                // OKSTAR 워터마크 추가 (우하단)
                ctx.fillStyle = 'rgba(79, 70, 229, 0.2)';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('© OKSTAR KOREA', canvas.width - 120, canvas.height - 20);
                
                return canvas;
            }
            
            canvasToBlob(canvas) {
                return new Promise(resolve => {
                    canvas.toBlob(blob => {
                        resolve(blob);
                    }, 'image/png', 1.0);
                });
            }
            
            async downloadAsZip(files) {
                const zip = new JSZip();
                const folder = zip.folder('OKSTAR_Printing_Output');
                
                // 저작권 정보 파일 추가
                const copyrightInfo = `
OKSTAR PRINTING PROGRAM v3.0
Copyright © 2024 OKSTAR KOREA COMPANY
All Rights Reserved.

이 파일들은 OKSTAR 프린팅 프로그램으로 제작되었습니다.
무단 배포 및 상업적 사용을 금지합니다.

제작일시: ${new Date().toLocaleString('ko-KR')}
총 파일 수: ${files.length}개

문의사항:
- Email: info@okstar.kr
- Support: support@okstar.kr
- Website: www.okstar.kr

OKSTAR KOREA COMPANY
Professional Printing Solutions
                `;
                
                folder.file('COPYRIGHT_OKSTAR.txt', copyrightInfo);
                
                files.forEach(file => {
                    folder.file(file.name, file.blob);
                });
                
                const content = await zip.generateAsync({
                    type: 'blob',
                    compression: 'DEFLATE',
                    compressionOptions: { level: 6 }
                });
                
                const timestamp = new Date().toISOString()
                    .replace(/[:.]/g, '')
                    .slice(0, 15);
                
                const a = document.createElement('a');
                a.href = URL.createObjectURL(content);
                a.download = `OKSTAR_tshirt_${timestamp}.zip`;
                a.click();
                
                URL.revokeObjectURL(a.href);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            showProgress(current, total) {
                const percent = Math.round((current / total) * 100);
                
                this.progressBar.style.display = 'block';
                this.progressBar.querySelector('.progress-text').textContent = 
                    `처리 중... (${current}/${total})`;
                this.progressFill.style.width = percent + '%';
                this.progressFill.textContent = percent + '%';
                
                this.saveBtn.disabled = true;
                this.saveBtnText.textContent = `처리 중... ${percent}%`;
            }
            
            hideProgress() {
                this.progressBar.style.display = 'none';
                this.saveBtn.disabled = false;
            }
            
            showSuccess(count) {
                const originalText = this.saveBtnText.textContent;
                
                this.saveBtn.classList.add('success');
                this.saveBtnText.textContent = `✅ ${count}개 색상 앞뒤 세트 저장 완료!`;
                
                setTimeout(() => {
                    this.saveBtn.classList.remove('success');
                    this.saveBtnText.textContent = originalText;
                    this.checkReadyState();
                }, 3000);
            }
        }
        
        // 앱 시작
        document.addEventListener('DOMContentLoaded', () => {
            const app = new FrontBackDesigner();
            console.log('🎨 옥스타 프린팅 프로그램 v3.0 시작');
            console.log('📞 문의: info@okstar.kr');
            console.log('🏢 OKSTAR KOREA COMPANY - Professional Printing Solutions');
        });

        // 간단한 보안 (우클릭 방지)
        document.addEventListener('contextmenu', e => {
            e.preventDefault();
            alert('© OKSTAR KOREA COMPANY\n우클릭이 차단되었습니다.');
            return false;
        });
    </script>
</body>
</html>