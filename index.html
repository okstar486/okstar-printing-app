<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="OKSTAR KOREA COMPANY">
    <meta name="copyright" content="© 2024 OKSTAR KOREA COMPANY. All Rights Reserved.">
    <meta name="description" content="Professional T-Shirt Design Solution by OKSTAR KOREA - v5.1">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-313E028ZYQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-313E028ZYQ');
    </script>
    
    <title>옥스타 프린팅 프로그램 v5.1 | OKSTAR KOREA COMPANY</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #1f2937;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .company-badge {
            display: inline-block;
            background: #4F46E5;
            color: white;
            padding: 6px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        /* 모드 선택 카드 */
        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            padding: 20px;
            background: #f0f9ff;
            border-radius: 15px;
            border: 2px solid #3b82f6;
            flex-wrap: wrap;
        }

        .mode-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .mode-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .mode-card.active {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            border-color: #3b82f6;
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .mode-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .instructions {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #92400e;
        }

        /* 모드별 컨텐츠 */
        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        .upload-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .upload-grid.single {
            grid-template-columns: 1fr;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .upload-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .upload-label {
            display: block;
            padding: 30px 15px;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            color: #475569;
            background: white;
        }

        .upload-label:hover {
            border-color: #6366f1;
            background: #f0f9ff;
        }

        .upload-label.uploaded {
            border-color: #10b981;
            background: #ecfdf5;
            color: #059669;
        }

        .file-list {
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px;
            background: white;
            margin-top: 10px;
            font-size: 12px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px;
            margin: 2px 0;
            background: #f8fafc;
            border-radius: 4px;
        }

        .tab-navigation {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding: 10px;
            background: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab-button:hover {
            background: #f0f9ff;
            border-color: #6366f1;
        }

        .tab-button.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .canvas-container.single {
            grid-template-columns: 1fr;
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .canvas-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .canvas-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        canvas {
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            background: white;
            width: 100%;
            height: auto;
            cursor: move;
            display: block;
        }

        .controls {
            margin-top: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-label {
            font-size: 13px;
            color: #475569;
            min-width: 60px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            background: #e2e8f0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }

        .scale-value {
            min-width: 45px;
            text-align: right;
            font-weight: bold;
            color: #1f2937;
            font-size: 13px;
        }

        .save-button {
            width: 100%;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .save-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .save-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 30px;
            background: #f9fafb;
            border-radius: 10px;
        }

        .position-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .position-btn:hover {
            border-color: #3b82f6;
        }

        .position-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* 디테일 컨트롤 박스 - 독립적인 스타일 */
        .detail-control-box {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #10b981;
            margin: 20px auto;
            max-width: 600px;
        }

        .detail-control-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .detail-control-title {
            font-weight: bold;
            color: #059669;
            margin-bottom: 10px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .mode-selector {
                flex-direction: column;
            }
            
            .upload-grid {
                grid-template-columns: 1fr;
            }
            
            .canvas-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                🎨 옥스타 프린팅 프로그램
                <span class="version-badge">v5.1</span>
            </h1>
            <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">Multi-Mode Professional T-Shirt Design Solution</p>
            <div class="company-badge">OKSTAR KOREA COMPANY</div>
        </div>

        <!-- 모드 선택 -->
        <div class="mode-selector">
            <div class="mode-card active" data-mode="front">
                <div class="mode-icon">👔</div>
                <div class="mode-title">앞판 전용</div>
                <div class="mode-desc">가슴 로고만 있는 디자인</div>
            </div>
            <div class="mode-card" data-mode="frontback">
                <div class="mode-icon">👕</div>
                <div class="mode-title">앞판+뒷판</div>
                <div class="mode-desc">앞뒤 모두 있는 풀디자인</div>
            </div>
            <div class="mode-card" data-mode="combine">
                <div class="mode-icon">🎨</div>
                <div class="mode-title">디자인 합성</div>
                <div class="mode-desc">앞뒤 디자인을 하나로 합치기</div>
            </div>
            <div class="mode-card" data-mode="colorchip">
                <div class="mode-icon">🎨</div>
                <div class="mode-title">컬러칩 제작</div>
                <div class="mode-desc">색상별 제품을 깔끔하게 정리</div>
            </div>
        </div>

        <div class="instructions">
            💡 <strong>사용법:</strong> 
            <span id="modeInstruction">1️⃣ 앞판 무지 티셔츠 업로드 2️⃣ 앞판 디자인 배치 3️⃣ 저장 → 색상별 자동 저장!</span>
        </div>

        <!-- 픽셀 크기 설정 -->
        <div style="text-align: center; margin: 15px 0;">
            <button id="pixelSizeBtn" style="padding: 8px 16px; background: #6366f1; color: white; border: none; border-radius: 6px; cursor: pointer;">
                📐 출력 크기 변경 (현재: 1500x1500px)
            </button>
        </div>

        <!-- 모드별 컨텐츠 영역 -->
        <div id="frontMode" class="mode-content active"></div>
        <div id="frontbackMode" class="mode-content"></div>
        <div id="combineMode" class="mode-content"></div>
        <div id="colorchipMode" class="mode-content"></div>

        <!-- 파일명 설정 및 저장 버튼 -->
        <div style="margin: 20px 0;">
            <div style="text-align: center; margin-bottom: 10px;">
                <label style="margin-right: 10px; font-weight: bold;">파일명:</label>
                <input type="text" id="filenameInput" placeholder="okstar" value="okstar" 
                       style="padding: 8px; border: 2px solid #e2e8f0; border-radius: 6px; width: 200px;">
                <span id="filenameHint" style="margin-left: 10px; color: #6b7280; font-size: 12px;">
                    예시: okstar-01-front.png
                </span>
            </div>
            <button id="saveBtn" class="save-button" disabled>
                <span>📦</span>
                <span id="saveBtnText">파일을 업로드하세요</span>
            </button>
        </div>

        <div class="footer">
            <div style="font-size: 14px; font-weight: bold; color: #4F46E5; margin-bottom: 5px;">
                OKSTAR KOREA COMPANY
            </div>
            © 2024 All Rights Reserved. Unauthorized use is strictly prohibited.<br>
            본 프로그램은 OKSTAR KOREA COMPANY의 지적 재산입니다.
        </div>
    </div>

    <!-- JSZip 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- 전역 설정 및 상태 -->
    <script>
        // 전역 설정
        window.outputWidth = 1500;
        window.outputHeight = 1500;  // 정사각형 유지
        
        // 전역 상태 관리
        window.appState = {
            currentMode: 'front',
            modes: {
                front: {},
                frontback: {},
                combine: {},
                colorchip: {}
            }
        };

        // 픽셀 크기 설정
        document.getElementById('pixelSizeBtn').addEventListener('click', () => {
            const width = prompt('가로 크기를 입력하세요 (px):', window.outputWidth);
            const height = prompt('세로 크기를 입력하세요 (px):', window.outputHeight);
            
            if (width && height && !isNaN(width) && !isNaN(height)) {
                // TODO(human): 5:6 비율 유지 로직 구현
                window.outputWidth = parseInt(width);
                window.outputHeight = parseInt(height);
                document.getElementById('pixelSizeBtn').textContent = 
                    `📐 출력 크기 변경 (현재: ${window.outputWidth}x${window.outputHeight}px)`;
            }
        });

        // 파일명 힌트 업데이트
        window.updateFilenameHint = function(mode) {
            const filenameHint = document.getElementById('filenameHint');
            const hints = {
                'front': '예시: okstar-01.png',
                'frontback': '예시: okstar-01-front.png, okstar-01-back.png',
                'combine': '예시: okstar-01-combined.png',
                'colorchip': '예시: colorchip-20241128.png'
            };
            filenameHint.textContent = hints[mode] || '';
        };

        // 저장 버튼 업데이트
        window.updateSaveButton = function() {
            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');
            
            let ready = false;
            let text = '파일을 업로드하세요';
            
            // 각 모드별 체크는 컴포넌트에서 구현
            if (window[`checkMode${appState.currentMode.charAt(0).toUpperCase() + appState.currentMode.slice(1)}Ready`]) {
                const result = window[`checkMode${appState.currentMode.charAt(0).toUpperCase() + appState.currentMode.slice(1)}Ready`]();
                ready = result.ready;
                text = result.text;
            }
            
            saveBtn.disabled = !ready;
            saveBtnText.textContent = text;
        };

        // 저장 성공 메시지
        window.showSaveSuccess = function(message) {
            const saveBtnText = document.getElementById('saveBtnText');
            const originalText = saveBtnText.textContent;
            
            saveBtnText.textContent = `✅ ${message}`;
            setTimeout(() => {
                saveBtnText.textContent = originalText;
                window.updateSaveButton();
            }, 2000);
        };

        // ZIP 다운로드 헬퍼
        window.downloadZip = async function(files, folderName) {
            const zip = new JSZip();
            const folder = zip.folder(folderName);
            
            files.forEach(file => {
                folder.file(file.name, file.blob);
            });
            
            const content = await zip.generateAsync({
                type: 'blob',
                compression: 'DEFLATE',
                compressionOptions: { level: 6 }
            });
            
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = `${folderName}_${Date.now()}.zip`;
            a.click();
            
            window.showSaveSuccess(`${files.length}개 파일 저장 완료!`);
        };

        // 저장 버튼 이벤트
        document.getElementById('saveBtn').addEventListener('click', () => {
            const modeName = appState.currentMode.charAt(0).toUpperCase() + appState.currentMode.slice(1);
            if (window[`saveMode${modeName}`]) {
                window[`saveMode${modeName}`]();
            }
        });

        // 모드 선택 초기화
        function initModeSelector() {
            const modeCards = document.querySelectorAll('.mode-card');
            const modeContents = document.querySelectorAll('.mode-content');
            const modeInstruction = document.getElementById('modeInstruction');
            
            const instructions = {
                'front': '1️⃣ 앞판 무지 티셔츠 업로드 2️⃣ 앞판 디자인 배치 3️⃣ 저장 → 색상별 자동 저장!',
                'frontback': '1️⃣ 앞뒤 무지 티셔츠 각각 업로드 2️⃣ 앞판 디자인 배치 (작게) 3️⃣ 뒷판 디자인 배치 (크게) 4️⃣ 저장!',
                'combine': '1️⃣ 완성된 앞판 이미지 업로드 2️⃣ 완성된 뒷판 이미지 업로드 3️⃣ 크기 조절 4️⃣ 합성 이미지 저장!',
                'colorchip': '1️⃣ 제품 이미지 업로드 (최대 20개) 2️⃣ 색상명 확인/수정 3️⃣ 레이아웃 조절 4️⃣ 컬러칩 저장!'
            };
            
            modeCards.forEach(card => {
                card.addEventListener('click', () => {
                    const mode = card.dataset.mode;
                    const previousMode = appState.currentMode;
                    appState.currentMode = mode;
                    
                    // 이전 모드 정리
                    if (previousMode && window[`cleanupMode${previousMode.charAt(0).toUpperCase() + previousMode.slice(1)}`]) {
                        try {
                            window[`cleanupMode${previousMode.charAt(0).toUpperCase() + previousMode.slice(1)}`]();
                        } catch (e) {
                            console.warn('Cleanup failed for mode:', previousMode, e);
                        }
                    }
                    
                    // UI 업데이트
                    modeCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    
                    modeContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(mode + 'Mode').classList.add('active');
                    
                    modeInstruction.textContent = instructions[mode];
                    window.updateFilenameHint(mode);
                    
                    // 해당 모드 초기화
                    const initFunctionName = `initMode${mode.charAt(0).toUpperCase() + mode.slice(1)}`;
                    if (mode === 'front') {
                        // Mode 1: front
                        if (window.initMode1) {
                            window.initMode1();
                        } else {
                            console.error('initMode1 not found');
                        }
                    } else if (mode === 'frontback') {
                        // Mode 2: frontback
                        if (window.initMode2) {
                            window.initMode2();
                        }
                    } else if (mode === 'combine') {
                        // Mode 3: combine
                        if (window.initMode3) {
                            window.initMode3();
                        }
                    } else if (mode === 'colorchip') {
                        // Mode 4: colorchip
                        if (window.initMode4) {
                            window.initMode4();
                        }
                    }
                    
                    // 저장 버튼 상태 업데이트
                    window.updateSaveButton();
                });
            });
        }

        // 우클릭 방지
        document.addEventListener('contextmenu', e => {
            e.preventDefault();
            alert('© OKSTAR KOREA COMPANY\n우클릭이 차단되었습니다.');
            return false;
        });

        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initModeSelector();
            
            // 기본 모드(Mode 1) 초기화
            setTimeout(() => {
                if (window.initMode1) {
                    console.log('Initializing Mode 1...');
                    window.initMode1();
                } else {
                    console.error('initMode1 function not found. Make sure mode1-front.js is loaded.');
                }
            }, 100); // 약간의 지연을 주어 모든 스크립트가 로드되도록 함
        });
    </script>

    <!-- 유틸리티 로드 -->
    <script src="utils.js"></script>
    
    <!-- 컴포넌트 로드 -->
    <script src="mode1-front.js"></script>
    <script src="mode2-frontback.js"></script>
    <script src="mode3-combine.js"></script>
    <script src="mode4-colorchip.js"></script>
</body>
</html>